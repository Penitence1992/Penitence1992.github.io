---
title: '有趣, 好用的算法代码记录'
categories:
  - - 代码
abbrlink: 1970526583
date: 2020-08-30 13:26:38
---

这章主要用于记录一些算法的代码, 使用, 或者有趣, 有灵魂的代码内容

<!-- more -->

## 一个数最近2的幂次数方法

> 摘取自: HashMap的tableSizeFor方法

```java
static final int tableSizeFor(int num) {
    int n = num - 1; // 减一是为了防止当输入为8的时候, 通过计算会计算出16这样的结果
    n |= n >>> 1;
    n |= n >>> 2;
    n |= n >>> 4;
    n |= n >>> 8;
    n |= n >>> 16;
    return (n < 0) ? 1 : (n >= MAX_VALUE) ? MAX_VALUE : n + 1;
}
```

在Java中, 一个`int`类型用了4字节, 共32bit, 计算过程可以理解如下:

```
cap           = 0000 1000 0000 0000 0000 0000 0000 0001
n = cap - 1   = 0000 1000 0000 0000 0000 0000 0000 0000
n |= n >>> 1  = 0000 1100 0000 0000 0000 0000 0000 0000
n |= n >>> 2  = 0000 1111 0000 0000 0000 0000 0000 0000
n |= n >>> 4  = 0000 1111 1111 0000 0000 0000 0000 0000
n |= n >>> 8  = 0000 1111 1111 1111 1111 0000 0000 0000
n |= n >>> 16 = 0000 1111 1111 1111 1111 1111 1111 1111
return n + 1  = 0001 0000 0000 0000 0000 0000 0000 0000
```

这样经过5次的右移+或操作, 可以将所有bit位置换为1, 然后通过最后的+1实现翻倍, 得到2的幂的结果